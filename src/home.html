<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.tailwindcss.com"></script>
        <title>Welcome!</title>
    </head>
    <body class="bg-[#ae9c75]">
        <span class="absolute text-white text-4xl top-5 left-4 cursor-pointer" onclick="openSidebar()"> 
        <i class="bi bi-filter-left px-2 bg-gray-900 rounded-md"></i>
        </span>
        <div class="sidebar fixed top-0 bottom-0 lg:left-0 p-2 w-[300px] overflow-y-auto text-center bg-gray-900">
            <div class="text-gray-100 text-xl">
                <div class="p-2.5 mt-1 flex items-center">
                    <i class="bi bi-app-indicator px-2 py-1 rounded-md bg-rose-950"></i>
                    <h1 class="font-bold text-gray-200 text-[15px] ml-3">CrowNest Security</h1>
                    <i
                        class="bi bi-x cursor-pointer ml-28 lg:hidden"
                        onclick="openSidebar()"
                        ></i>
                </div>
                <div class="my-2 bg-gray-600 h-[1px]"></div>
            </div>
            <div class="p-2.5 flex items-center rounded-md px-4 duration-300 cursor-pointer bg-gray-700 text-white">
                <i class="bi bi-search text-sm"></i>
                <input
                    type="text"
                    placeholder="Search for a service"
                    class="text-[15px] ml-4 w-full bg-transparent focus:outline-none"
                    />
            </div>
            <div class="p-2.5 mt-3 flex items-center rounded-md px-4 duration-300 cursor-pointer hover:bg-rose-950 text-white">
                <i class="bi bi-house-door-fill"></i>
                <span class="text-[15px] ml-2 text-gray-200 font-bold">Home</span>
            </div>
            <div id="aboutDiv" class="p-2.5 mt-3 flex items-center rounded-md px-4 duration-300 cursor-pointer hover:bg-rose-950 text-white">
                <i class="bi bi-bookmark-fill"></i>
                <span class="text-[15px] ml-2 text-gray-200 font-bold">About</span>
            </div>
            
            <div class="p-2.5 mt-3 flex items-center rounded-md px-4 duration-300 cursor-pointer hover:bg-rose-950 text-white" onclick="dropdown()">
                <i class="bi bi-chat-left-text-fill"></i>
                <div class="flex justify-between w-full items-center">
                    <span class="text-[15px] ml-2 text-gray-200 font-bold">Add a Password</span>
                    <span class="text-sm rotate-180" id="arrow">
                    <i class="bi bi-chevron-down"></i>
                    </span>
                </div>
            </div>
            <form action="/insert_password" method="POST">
                <div class="text-left text-sm mt-2 w-4/5 mx-auto text-gray-200 font-bold" id="submenu">
                    <label class="font-medium block mb-1 mt-4 text-white" for="username">Service</label>
                        <input spellcheck="false" class="appearance-none border-2 rounded w-full py-3 px-3 leading-tight border-gray-300 bg-gray-100 focus:outline-none focus:border-indigo-700 focus:bg-white text-gray-700 pr-16 font-mono" id="service" type="text" autocomplete="off" autofocus name="service" />

                    <label class="font-medium block mb-1 mt-4 text-white" for="username">Username</label>
                        <input spellcheck="false" class="appearance-none border-2 rounded w-full py-3 px-3 leading-tight border-gray-300 bg-gray-100 focus:outline-none focus:border-indigo-700 focus:bg-white text-gray-700 pr-16 font-mono" id="username" type="text" autocomplete="off" autofocus name="username" />
                    <label class="font-medium block mb-1 mt-4 text-white" for="password">Password</label>
                    <div class="relative w-full">
                        <div class="absolute inset-y-0 right-0 flex items-center px-2">
                            <input spellcheck="false" class="hidden js-password-toggle" id="toggle" type="checkbox" />
                            <label class="bg-gray-300 hover:bg-gray-400 rounded px-2 py-1 text-sm text-gray-600 font-mono cursor-pointer js-password-label" for="toggle">show</label>
                        </div>
                        <input class="appearance-none border-2 rounded w-full py-3 px-3 leading-tight border-gray-300 bg-gray-100 focus:outline-none focus:border-indigo-700 focus:bg-white text-gray-700 pr-16 font-mono js-password" id="password" type="password" autocomplete="off" name="password"/>
                    </div>
                    <button class="w-full bg-rose-950 hover:bg-rose-800 text-white font-medium py-3 px-4 mt-5 rounded focus:outline-none focus:shadow-outline" type="submit">
                        Encrypt and Store Password
                    </button>
                </div>
            </form>
            <div class="my-4 bg-gray-600 h-[1px]"></div>
            <div id="logoutButton" class="p-2.5 mt-3 flex items-center rounded-md px-4 duration-300 cursor-pointer hover:bg-rose-950 text-white">
                <i class="bi bi-box-arrow-in-right"></i>
                <span class="text-[15px] ml-2 text-gray-200 font-bold">Logout</span>
            </div>
        </div>
        <div class="main-content ml-[300px] p-5">
            <!-- Your main content goes here -->
            <h1 class="font-large font-bold text-3xl text-center py-4 text-gray-800">{{USERNAME}}'s nest</h1>
            <div class="hidden">{{ALERT}}</div>
            <div class="main-content p-5 flex justify-center">
                <div class="space-y-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="hidden">{{PASSWORDS}}</div>
                    <!-- Item example -->
                    <!--<div id="card1"class="bg-gray-900 rounded-lg shadow p-4 border-2 border-rose-900 hover:border-rose-700">
                        <h2 class="text-2xl text-gray-400 font-bold mb-1">Google</h2>
                        <p class="text-sm text-gray-400 mb-2">username</p>
                        <div class="relative w-full">
                            <div class="absolute inset-y-0 right-0 flex items-center px-2">
                                <input class="hidden password-toggle" id="toggle1" type="checkbox" />
                                <label class="bg-gray-300 hover:bg-gray-400 rounded px-2 py-1 text-sm text-gray-600 font-mono cursor-pointer password-label" for="toggle1">show</label>
                            </div>
                            <input class="appearance-none border-2 rounded w-full py-3 px-3 leading-tight border-gray-300 bg-gray-100 focus:outline-none focus:border-rose-900 focus:bg-white text-gray-700 pr-16 font-mono password-field" id="password1" type="password" value="password123" readonly/>
                        </div>
                    </div>
                    <div id="card2"class="bg-gray-900 rounded-lg shadow p-4 border-2 border-rose-900 hover:border-rose-700">
                        <h2 class="text-2xl text-gray-400 font-bold mb-1">Google</h2>
                        <p class="text-sm text-gray-400 mb-2">username</p>
                        <div class="relative w-full">
                            <div class="absolute inset-y-0 right-0 flex items-center px-2">
                                <input class="hidden password-toggle" id="toggle2" type="checkbox" />
                                <label class="bg-gray-300 hover:bg-gray-400 rounded px-2 py-1 text-sm text-gray-600 font-mono cursor-pointer password-label" for="toggle2">show</label>
                            </div>
                            <input class="appearance-none border-2 rounded w-full py-3 px-3 leading-tight border-gray-300 bg-gray-100 focus:outline-none focus:border-rose-900 focus:bg-white text-gray-700 pr-16 font-mono password-field" id="password1" type="password" value="password123" readonly/>
                        </div>
                    </div>-->
                    <!-- Other items can be added here -->
                </div>
            </div>
            

        </div>

        <script type="text/javascript">
            function dropdown() {
                document.querySelector("#submenu").classList.toggle("hidden");
                document.querySelector("#arrow").classList.toggle("rotate-0");
            }
            dropdown();
            
            function openSidebar() {
                document.querySelector(".sidebar").classList.toggle("hidden");
            }

            const passwordToggle = document.querySelector('.js-password-toggle')

            passwordToggle.addEventListener('change', function() {
            const password = document.querySelector('.js-password'),
                passwordLabel = document.querySelector('.js-password-label')

            if (password.type === 'password') {
                password.type = 'text'
                passwordLabel.innerHTML = 'hide'
            } else {
                password.type = 'password'
                passwordLabel.innerHTML = 'show'
            }

            password.focus()
            })

            const passwordToggles = document.querySelectorAll('.password-toggle');

            passwordToggles.forEach(function(toggle) {
                toggle.addEventListener('change', function() {
                    const cardId = 'card' + toggle.id.replace('toggle', '');
                    const card = document.querySelector('#' + cardId);
                    const password = card.querySelector('.password-field');
                    const passwordLabel = card.querySelector('.password-label');

                    if (password.type === 'password') {
                        password.type = 'text';
                        passwordLabel.innerHTML = 'hide';
                    } else {
                        password.type = 'password';
                        passwordLabel.innerHTML = 'show';
                    }

                    password.focus();
                });
            });


            document.getElementById("aboutDiv").addEventListener("click", function() {
                window.location.href = "/about";
            });

            document.addEventListener("DOMContentLoaded", function() {
                const deleteButtons = document.querySelectorAll('.delete-btn');

                deleteButtons.forEach(function(button) {
                    button.addEventListener('click', function() {
                        const service = this.getAttribute("data-service");
                        const username = this.getAttribute("data-username");

                        fetch('/delete_password', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ service: service, username: username })
                        })
                        .then(response => {
                            // Check if the response status is not successful
                            if (!response.ok) {
                                throw new Error(`HTTP error! Status: ${response.status}`);
                            }
                            return response.text();
                        })
                        .then(html => {
                            if (html) {
                                // Replace the entire page content with the returned HTML
                                document.documentElement.innerHTML = html;
                                // Optional: Re-attach the event listeners if needed or use event delegation
                            } else {
                                console.error("Failed to delete password. Empty response received.");
                            }
                        })
                        .catch(error => {
                            console.error('Fetch error:', error.message);
                        });
                    });
                });
            });
            document.getElementById("logoutButton").addEventListener("click", function() {
                fetch('/logout', {
                    method: 'GET', // or 'POST' if you've set up your logout route as a POST
                })
                .then(response => response.text())
                .then(data => {
                    // Handle the response from the server
                    // For example, redirect to a login page or show a logout message
                    window.location.href = '/'; // This will redirect to the main page after logout. Adjust as needed.
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            });
        </script>
    </body>
</html>